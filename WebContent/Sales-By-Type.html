<!DOCTYPE html>
<html>
	<head>
		<link rel="stylesheet"
	href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
<link rel="stylesheet" href="resources/css/style.css">
<link rel="stylesheet" href="resources/css/bootstrap-multiselect.css">

<script src="http://code.jquery.com/jquery-latest.min.js" type="text/javascript"></script>
<script
	src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script
	src="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>


<!-- Resources -->
<script src="resources/js/policy.js"></script>
<script src="resources/js/bootstrap-multiselect.js"></script>
<script src="resources/js/componentData.js"></script>

<script
	src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.9.0/moment-with-locales.js"></script>
<script
	src="//cdn.rawgit.com/Eonasdan/bootstrap-datetimepicker/d004434a5ff76e7b97c8b07c01f34ca69e635d97/src/js/bootstrap-datetimepicker.js"></script>
<link
	href="//cdn.rawgit.com/Eonasdan/bootstrap-datetimepicker/d004434a5ff76e7b97c8b07c01f34ca69e635d97/build/css/bootstrap-datetimepicker.css"
	rel="stylesheet">

<script type="text/javascript" src="https://www.google.com/jsapi"></script>

<!-- High Charts API --> 

<script src="http://code.highcharts.com/highcharts.js"></script>
<script src="http://code.highcharts.com/highcharts-3d.js"></script>
<script src="http://code.highcharts.com/modules/exporting.js"></script>
				
	</head>
	<body>
		<script type="text/javascript">
			$(function () { 
				var brands = $('#filterByCombo option:selected');
	        	var selected;
	        	$(brands).each(function(index, brand){
	        		selected = $(this).val();
	        	});
	        	console.log(selected);
				var processed_json = new Array();
				var life_count,med_count,veh_count;
				$.map(jsonData, function(obj, i) {
					life_count =  $.grep(jsonData, function (element, index) { 
						return element.policy.type == "Life";}).length;
					med_count =  $.grep(jsonData, function (element, index) { 
						return element.policy.type == "Medical";}).length;
					veh_count =  $.grep(jsonData, function (element, index) { 
						return element.policy.type == "Vehicle";}).length;
				});
				processed_json.push(["Vehicle", veh_count]);
				processed_json.push(["Life", life_count]);
				processed_json.push(["Medical", med_count]);

				$('#pieChart').highcharts({
	        		chart: {
            			type: 'pie',
            			options3d: {
							enabled: true,
                			alpha: 60,
                			beta: 0,
            			}
        			},
        			title: {
        				text: 'Total Sales by Type'
        			},
        			tooltip: {
        				pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
        			},
	       			plotOptions: {
		   	        	pie: {
    	            		depth: 30,
    	            		allowPointSelect: true,
                			cursor: 'pointer',
                			dataLabels: {
                    			enabled: true,
                    			format: '<b>{point.name}</b>: {point.percentage:.1f} %',
                    			style: {
                        			color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'
                    			}
                			},
                			point: {
                                events: {
                                    click: function() {
                                    	console.log(this.name);
                                    	$("#columnChart").load(this.name+selected+	".html");                            
                                    }
                                }
                            }
            			}
        			},
	        
		     	   	series: [{
		     	   		type: 'pie',
            			name: 'Policy Type',
    	     			data: processed_json
        			}]
    			});
  			});
		</script>
		<div class="row">
			<div class="col-sm-2">
				<div class="input-group">
					<span class="input-group-addon">Group by</span> <select
						data-hover="dropdown" data-toggle="dropdown"
						id="filterByCombo">
					</select>
				</div>
			</div>
		</div>
		<div class="row">
		<div id="pieChart" class="col-md-6"></div>
		<div id="columnChart" class="col-md-6"></div>
		</div>
	</body>
</html>